<!DOCTYPE html>
<html>
	<head>
		<meta name="robots" content="all" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="description" content="七牛云存储API和SDK文档" />
		<meta name="keywords" content="七牛, 七牛云存储, 七牛云存储API, 七牛云存储SDK, qrsync, qboxrsctl, QinuRS, S3" />
		<meta name="author" content="qiniu.com" />
		<meta name="copyright" content="qiniu.com" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Language" content="zh-cn" />
		<meta http-equiv="imagetoolbar" content="false" />
		<meta name="MSSmartTagsPreventParsing" content="true" />
		<title>Pipeline API | 七牛云存储</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/gif" />
		<link href="/static/css/reset.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/960.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/uv_active4d.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
	</head>
	<body class="api">
		<div id="header-wrapper">
			<div id="header">
				<div>
					<a class="logo" href="/">七牛云存储</a>
					<ul class="nav">
						<li><a href="https://portal.qiniu.com">开发者平台</a></li>
						<li><a href="http://www.qiniu.com">七牛官网</a></li>
						<!-- <li><a href="/faq/FAQ.html">FAQ</a></li> -->
					</ul>
				</div>
			</div><!-- #header -->
		</div><!-- #header-wrapper -->

		<div id="wrapper">
			<div class="content">	
				<h1>Pipeline API<span id="version">v6</span></h1>
				<article>
				<p>已知，七牛云存储的云处理API满足如下规格:</p>

<pre><code>[GET] url?&lt;fop&gt;
</code></pre>

<p>即基于文件的 URL 通过问号传参来实现即时云处理，<code>&lt;fop&gt;</code> 表示 API 指令及其所需要的参数，是 File Operation 的缩写，表示文件处理。</p>

<p>那么，将一个资源经由多个 <code>&lt;fop&gt;</code> 链式处理，各 <code>&lt;fop&gt;</code> 之间用竖线（<code>|</code>）分割，我们称之为 Pipeline API。也称之为管道操作，熟悉 Linux 命令行的开发者可能会有更透彻的理解。</p>

<p>Pipeline API 规格如下</p>

<pre><code>[GET] url?&lt;fop1&gt;|&lt;fop2&gt;|&lt;fop3&gt;|&lt;fopN&gt;
</code></pre>

<p><code>url</code> 获取可以参考 <a href="get.html">下载接口</a></p>

<h2>样例</h2>

<h3>例1: 将一个原图缩略，然后在缩略图上打上另外一个图片作为水印</h3>

<ul>
<li>原图

<ul>
<li><a href="http://qiniuphotos.qiniudn.com/gogopher.jpg">http://qiniuphotos.qiniudn.com/gogopher.jpg</a></li>
</ul></li>
<li>基于原图生成缩略图

<ul>
<li><a href="http://qiniuphotos.qiniudn.com/gogopher.jpg?imageView/2/h/200">http://qiniuphotos.qiniudn.com/gogopher.jpg?imageView/2/h/200</a></li>
</ul></li>
<li>在生成的缩略图之上打水印

<ul>
<li><a href="http://qiniuphotos.qiniudn.com/gogopher.jpg?imageView/2/h/200|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==">http://qiniuphotos.qiniudn.com/gogopher.jpg?imageView/2/h/200|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==</a></li>
</ul></li>
</ul>

<h3>例2: 从视频中提取某一帧生成缩略图，然后基于该缩略图打水印</h3>

<ul>
<li>视频

<ul>
<li><a href="http://open.qiniudn.com/thinking-in-go.mp4">http://open.qiniudn.com/thinking-in-go.mp4</a></li>
</ul></li>
<li>提取视频帧并生成缩略图

<ul>
<li><a href="http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360">http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360</a></li>
</ul></li>
<li>在生成的缩略图之上打水印

<ul>
<li><a href="http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==">http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==</a></li>
</ul></li>
</ul>

<h2>别名</h2>

<p>如果觉得 <code>url?&lt;fop1&gt;|&lt;fop2&gt;|&lt;fop3&gt;|&lt;fopN&gt;</code> 这样的形式够冗长，还可以为这些串行的 <code>&lt;fop&gt;</code> 集合定义一个友好别名。如此一来，就可以用友好URL风格进行访问。</p>

<p>我们先来熟悉 <a href="/tools/qboxrsctl.html">qboxrsctl</a> 的两个命令行，</p>

<pre><code>// 定义 url 和 fop 之间的分隔符为 separator 
qboxrsctl separator &lt;bucket&gt; &lt;separator&gt;

// 定义 fop 的别名为 aliasName
qboxrsctl style &lt;bucket&gt; &lt;aliasName&gt; &lt;fop&gt;
</code></pre>

<p>例如:</p>

<pre><code>qboxrsctl separator &lt;bucket&gt; &quot;.&quot;
qboxrsctl style &lt;bucket&gt; &quot;jpg&quot; &quot;vframe/jpg/offset/7/w/480/h/360|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==&quot;
</code></pre>

<p>那么，以下两个 URL 则等价:</p>

<p>原始URL:</p>

<ul>
<li><a href="http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==">http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360|watermark/1/image/aHR0cDovL3d3dy5iMS5xaW5pdWRuLmNvbS9pbWFnZXMvbG9nby0yLnBuZw==</a></li>
</ul>

<p>友好风格URL:</p>

<ul>
<li><a href="http://open.qiniudn.com/thinking-in-go.mp4.jpg">http://open.qiniudn.com/thinking-in-go.mp4.jpg</a></li>
</ul>

				</article>
			</div>

			<div id="js-sidebar" class="sidebar-shell">
				<div class="js-toggle-list sidebar-module expandable">
					<ul>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">新手上路</span></h3>
						<ul class="js-guides">
							<li><a href="/guide/testing.html">测试指南</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">API</span></h3>
						<ul class="js-guides">
							<li><a href="/api/put.html">上传</a></li>
							<li><a href="/api/get.html">下载</a></li>
							<li><a href="/api/file-handle.html">文件管理</a></li>
							<li><a href="/api/image-process.html">图像处理</a></li>
							<li><a href="/api/audio-video-hls-process.html">音频/视频/流媒体处理</a></li>
							<li><a href="/api/qrcode.html">生成二维码 - QR code</a></li>
							<li><a href="/api/markdown-convert.html">Markdown 转 HTML</a></li>
							<li><a href="/api/pipeline.html">Pipeline API</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">SDK</span></h3>
						<ul class="js-guides">
							<li><a href="/ios-sdk/index.html">Objective-C (iOS)</a></li>
							<li><a href="/android-sdk/index.html">Java (Android)</a></li>
							<li><a href="/java-sdk/index.html">Java</a></li>
							<li><a href="/php-sdk/index.html">PHP</a></li>
							<li><a href="/python-sdk/index.html">Python</a></li>
							<li><a href="/ruby-sdk/index.html">Ruby</a></li>
							<li><a href="/nodejs-sdk/index.html">Node.js</a></li>
							<li><a href="/csharp-sdk/index.html">C#</a></li>
							<li><a href="/c-sdk/index.html">C/C++</a></li>
							<li><a href="/go-sdk/index.html">Go</a></li>
							<li><a href="/perl-sdk/index.html">Perl</a></li>							
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">上传及开发调试工具</span></h3>
						<ul class="js-guides">
							<li><a href="/tools/qrsync.html">qrsync</a></li>
							<li><a href="/tools/qboxrsctl.html">qboxrsctl</a></li>
							<li><a href="/tools/qiniu-autosync.html">qiniu-autosync</a></li>
						</ul>
						</li>
					</ul>
				</div> <!-- /sidebar-module -->
				<div class="sidebar-module">
					<p>帮助联系: <a href="mailto:support@qiniu.com">support@qiniu.com</a></p>
				</div>
			</div><!-- /sidebar-shell -->

		</div><!-- #wrapper -->

		<div id="footer" >
			<div class="lower_footer">
				<div class="footer_inner clearfix">
					<p>&copy; <span id="year">2012-2013</span> <a href="/">docs.qiniu.com</a>. All rights reserved. Powerd by <a href="http://www.qiniu.com" target="_blank">七牛云存储</a>. <a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备11037377号-2</a></p>
				</div><!-- /.site -->
			</div><!-- /.lower_footer -->
		</div><!-- /#footer -->

		<!-- <div class="popover fade top in"><div class="arrow"></div><h3 class="popover-title">Pipeline API</h3><div id="popover-content"></div></div> -->
		<script src="/static/js/jquery.js" type="text/javascript"></script>
		<script src="/static/js/qiniudoc.js" type="text/javascript"></script>
		<script src="/static/js/jquery.scrollUp.min.js"></script>
		<script type="text/javascript">
			   //var sdkName = "Pipeline API"
				 //$("#popover-content").html($("article ul")[0].outerHTML)
				 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
					m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
					})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

					ga('create', 'UA-40857860-3', 'qiniu.com');
					ga('send', 'pageview');
		 </script>
	 </body>
 </html>

<!DOCTYPE html>
<html>
	<head>
		<meta name="robots" content="all" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="description" content="七牛云存储API和SDK文档" />
		<meta name="keywords" content="七牛, 七牛云存储, 七牛云存储API, 七牛云存储SDK, qrsync, qboxrsctl, QinuRS, S3" />
		<meta name="author" content="qiniu.com" />
		<meta name="copyright" content="qiniu.com" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Language" content="zh-cn" />
		<meta http-equiv="imagetoolbar" content="false" />
		<meta name="MSSmartTagsPreventParsing" content="true" />
		<title>测试指南 | 七牛云存储</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/gif" />
		<link href="/static/css/reset.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/960.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/uv_active4d.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
	</head>
	<body class="api">
		<div id="header-wrapper">
			<div id="header">
				<div>
					<a class="logo" href="/">七牛云存储</a>
					<ul class="nav">
						<li><a href="https://portal.qiniu.com">开发者平台</a></li>
						<li><a href="http://www.qiniu.com">七牛官网</a></li>
						<!-- <li><a href="/faq/FAQ.html">FAQ</a></li> -->
					</ul>
				</div>
			</div><!-- #header -->
		</div><!-- #header-wrapper -->

		<div id="wrapper">
			<div class="content">	
				<h1>测试指南<span id="version"><no value></span></h1>
				<article>
				<ul>
<li><a href="#speed">下载测速</a></li>
<li><a href="#image-process">图片在线处理</a></li>
<li><a href="#audio-video-process">音频/视频在线压缩转码</a>

<ul>
<li><a href="#hls">HTTP Live Streaming - 流媒体</a></li>
</ul></li>
<li><a href="#upload">上传测试</a></li>
<li><a href="#private-download">文件隐私安全保护</a></li>
</ul>

<p><a name="speed"></a></p>

<h2>下载测速</h2>

<p>为了方便测试，我们已经人工上传了一个测试音频，同时将文件所在的存储空间暂设为公开属性。公开属性表示我们上传的文件能够以 HTTP 的方式公开提供下载。公开URL如下：</p>

<p><a href="http://apitest.b1.qiniudn.com/sample.wav">http://apitest.b1.qiniudn.com/sample.wav</a></p>

<p>该文件是一段时长为1分30秒的无损音频，文件体积约为：15.27 MB 。可以用第三方测速工具针对该 URL 进行下载测速。</p>

<p>实测全国平均下载速度为：<strong>3.75MB/s</strong></p>

<p>实测地址: <a href="http://17ce.com/">http://17ce.com/</a></p>

<p><a name="image-process"></a></p>

<h2>图片在线处理</h2>

<p>我们选取一家在使用七牛云存储的互联网初创公司——<a href="http://chanyouji.com/">蟬￼游记</a>作为我们的测试案例。</p>

<p>蟬游记网站 <a href="http://chanyouji.com/">http://chanyouji.com/</a> 主要以图片为主，这些图片都存于七牛云存储，使用七牛云存储提供的在线缩略图处理和加速分发功能。我们可以随便挑选一张图片作为测试。</p>

<p><strong>原图</strong>:</p>

<ul>
<li><a href="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg">http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg</a></li>
</ul>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg" alt="原图" />
</p>

<p><strong>水印</strong>（将蟬游记LOGO打到原图上去）:</p>

<ul>
<li><a href="http://goo.gl/29i2B">http://goo.gl/29i2B</a> (可点击查看完整URL)</li>
</ul>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?watermark/1/image/aHR0cDovL2N5anMucWluaXVkbi5jb20vYXNzZXRzL3RvcC1sb2dvLTViMTY2MWVhZmVhODY5NDY3YjgzM2Y0Yjk3MjgyNDNiLnBuZw==/dissolve/85/gravity/SouthEast/dx/20/dy/20" alt="水印" />
</p>

<p><strong>缩略图1</strong></p>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg-home_4" alt="缩略图1" />
</p>

<p>缩略图1源文件URL如下:</p>

<ul>
<li><a href="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/395/q/80">http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/395/q/80</a> (裸API形式)</li>
<li><a href="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg-home_4">http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg-home_4</a> (自定义API规格别名)</li>
<li>以上两个URL等价，即 <code>home_4</code> 是 <code>imageView/1/w/310/h/395/q/80</code> 的API规格别名。</li>
</ul>

<p><strong>缩略图2</strong>（可指定URL中任意宽高等参数来调整缩略图的大小）</p>

<ul>
<li><a href="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/187/q/80/format/webp">http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/187/q/80/format/webp</a> (支持webp等其他图片格式互转)</li>
</ul>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/187/q/80" alt="缩略图2（可指定任意宽高等参数来调整缩略图的大小）" />
</p>

<p><strong>缩略图3</strong> (缩略、裁剪、旋转)</p>

<ul>
<li><a href="http://goo.gl/4eJff">http://goo.gl/4eJff</a> (可点击查看完整URL)</li>
</ul>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageMogr/auto-orient/thumbnail/!310x310r/gravity/center/crop/!310x310/quality/80/rotate/45" alt="缩略图3缩略、裁剪、旋转" />
</p>

<p><strong>缩略图4</strong> (API链式处理，基于缩略图打水印)</p>

<ul>
<li><a href="http://goo.gl/kkxGe">http://goo.gl/kkxGe</a> (可点击查看完整URL)</li>
</ul>

<p><img src="http://cyj.qiniudn.com/22734/1359639667984p17i8ddoi31ara1ccp1njsq319s62.jpg?imageView/1/w/310/h/187/q/80|watermark/1/image/aHR0cDovL2N5anMucWluaXVkbi5jb20vYXNzZXRzL3RvcC1sb2dvLTViMTY2MWVhZmVhODY5NDY3YjgzM2Y0Yjk3MjgyNDNiLnBuZw==/dissolve/85/gravity/SouthEast" alt="API链式处理，基于缩略图打水印" />
</p>

<h3>更多</h3>

<ul>
<li><a href="/api/image-process.html">七牛云存储图像处理 API</a></li>
<li>蟬游记-七牛云存储使用心得：<a href="http://quake.iteye.com/blog/1816807">http://quake.iteye.com/blog/1816807</a></li>
</ul>

<p><a name="audio-video-process"></a></p>

<h2>音频/视频在线压缩转码</h2>

<p>七牛云存储支持常见的音视频格式互转，比如 mp3、aac，m4a, mp4、avi、flv 等。支持互转的音频格式可参考：<a href="http://ffmpeg.org/general.html#File-Formats">http://ffmpeg.org/general.html#File-Formats</a></p>

<p>示例1：将 wav 音频格式转换为 mp3 格式：</p>

<p>[GET] <a href="http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3">http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3</a></p>

<p>示例2：将 wav 音频格式转换为 mp3 格式，并指定静态码率（CBR）为 192k：</p>

<p>[GET] <a href="http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3/ab/192k">http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3/ab/192k</a></p>

<p>示例3：将 wav 音频格式转换为 mp3 格式，并指定动态码率（VBR）参数为3，采样频率为 44100：</p>

<p>[GET] <a href="http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3/ar/44100/aq/3">http://apitest.b1.qiniudn.com/sample.wav?avthumb/mp3/ar/44100/aq/3</a></p>

<p>示例4：视频帧提取</p>

<p>源视频</p>

<ul>
<li>[GET] <a href="http://open.qiniudn.com/thinking-in-go.mp4">http://open.qiniudn.com/thinking-in-go.mp4</a></li>
</ul>

<p>取视频第 7 秒的截图，图片格式为 jpg，宽度为 480px，高度为 360px</p>

<ul>
<li>[GET] <a href="http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360">http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360</a></li>
</ul>

<p><img src="http://open.qiniudn.com/thinking-in-go.mp4?vframe/jpg/offset/7/w/480/h/360" alt="获取视频帧缩略图" />
</p>

<ul>
<li><a href="/api/audio-video-hls-process.html">七牛云存储音/视频处理接口</a></li>
</ul>

<p><a name="hls"></a></p>

<h3>HTTP Live Streaming - 流媒体</h3>

<p>七牛云存储支持 Apple 提出的基于 HTTP 的流媒体传输协议（HTTP Live Streaming，简称 HLS）。 基于HLS技术，可将一整个音视频文件切割成可由 HTTP 传输下载的一个个细碎的音视频流，并生成一个播放列表（M3U8），客户端只需要获取资源的 M3U8 播放列表URL即可以流式地播放该音视频。</p>

<p>目前 iOS, Android 3.0+ 系列的设备包括 Safari 浏览器都可以直接播放 HLS 的音视频，并且 HLS 可以通过传统的 CDN （内容分发网络）和七牛的加速节点来加速分发（七牛目前的加速节点超过500+）。</p>

<p>除此之外，七牛云存储的 HLS 还有一个显著优点，可以基于同一份音视频文件转码多份 m3u8 playlist，即实现音视频播放多码率自适应终端用户网络带宽环境。当终端用户网络质量不佳时，优先播放低码率音视频流，当网络质量优时，可自动切换到高品质音视频流。流式播放输出，无需等待缓冲，智能切换码率不卡顿，用户体验极佳。</p>

<p>以下URL就是一个已经使用七牛 HLS API 处理的流媒体资源：</p>

<ul>
<li><a href="http://apitest.b1.qiniudn.com/sample.wav-m3u8_audio">http://apitest.b1.qiniudn.com/sample.wav-m3u8_audio</a></li>
</ul>

<p>其中 <code>m3u8_audio</code> 是自定义的 API 规格别名（<code>avthumb/m3u8/preset/audio_32k</code>）。</p>

<p>您可以使用播放器来打开该 URL 进行流媒体播放体验。参考:</p>

<ul>
<li><a href="https://softron.zendesk.com/entries/22255163-how-to-view-an-hls-stream-in-quicktime-or-vlc">HOW TO: View an HLS Stream in QuickTime or VLC</a></li>
<li>或者使用 HTML5 的 audio/video 标签，如下代码:</li>
</ul>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;HTML5 HLS Demo&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;audio src=&quot;http://apitest.b1.qiniudn.com/sample.wav-m3u8_audio&quot; controls=&quot;true&quot;&gt;&lt;/audio&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>将以上 HTML 代码保存为一个后缀为 <code>.html</code> 的文件，然后用 <a href="http://www.apple.com.cn/safari/">Apple Safari</a> 浏览器打开网页即可体验流媒体播放。</p>

<ul>
<li>七牛云存储 <a href="/api/audio-video-hls-process.html#hls">HTTP Live Streaming API</a></li>
</ul>

<p>支持 <a href="/api/audio-video-hls-process.html#upload-fop">在上传时进行异步预转</a>，终端用户访问时获得更好的用户体验。</p>

<p>我们还在深化 HLS API, 欢迎提供建议！</p>

<p><a name="upload"></a></p>

<h2>测试上传文件</h2>

<p>为方便测试，我们准备了测试帐号，并使用七牛提供的上传工具。</p>

<p>实际情况下，若您的业务偏 UGC(User Generate Content)，可以使用 <a href="https://github.com/qiniu">七牛提供的SDK</a> 让终端用户直传图片/音频/视频/文件到七牛云存储。</p>

<p>若不想用测试帐号，也可自行注册申请帐号。注册地址：<a href="https://portal-beta.qiniu.com/signup">https://portal-beta.qiniu.com/signup</a></p>

<p>为方便测试，我们在测试帐号申里边创建了一个名为 <code>qtestbucket</code> 的存储空间。</p>

<p>然后可以使用七牛云存储提供的 <a href="/tools/qrsync.html">qrysnc</a> 进行文件上传。</p>

<p>可以点击如下网址下载 qrsync 工具，以及了解其用法：</p>

<p>以下内容可以存档为 <code>qiniu-test-config.json</code>，其配置是根据测试帐号相关的。其中 <code>sync_dir</code> 项需要修改成绝对路径。注意：Windows 平台上路径的表示格式为：<code>盘符:/目录</code>，比如 E 盘下的路径 <code>data/photos</code> 表示为：<code>e:/data/photos</code>。</p>

<pre><code>{
    &quot;access_key&quot;: &quot;iN7NgwM31j4-BZacMjPrOQBs34UG1maYCAQmhdCV&quot;,
    &quot;secret_key&quot;: &quot;6QTOr2Jg1gcZEWDQXKOGZh5PziC2MCV5KsntT70j&quot;,
    &quot;bucket&quot;: &quot;qtestbucket&quot;,
    &quot;sync_dir&quot;: &quot;/PATH/TO/YOUR/SYNC_DIR&quot;,// 需根据实际情况自行替换
    &quot;domains&quot;: [&quot;qtestbucket.b1.qiniudn.com&quot;,&quot;qtestbucket.qiniudn.com&quot;],
    &quot;debug_level&quot;: 1
}
</code></pre>

<p>配置项说明可参考上述提到的 <a href="/tools/qrsync.html">qrsync使用文档</a> 。</p>

<p><code>qiniu-test-config.json</code> 修改并存档完毕后，可在 <code>sync_dir</code> 所指定的目录放入需要进行上传的具体文件（可包含子目录结构）。然后进入到 qrsync 所在的目录，运行以下命令行：</p>

<pre><code>$ qrsync /PATH/TO/qiniu-test-config.json
</code></pre>

<p>控制台输出可以看到文件上传的具体信息。</p>

<p><a name="private-download"></a></p>

<h2>下载文件</h2>

<p><strong>公有资源下载</strong></p>

<pre><code>http://&lt;空间绑定域名&gt;/&lt;key&gt;
</code></pre>

<p>在我们前面的示例中，此URL: <a href="http://apitest.b1.qiniudn.com/sample.wav">http://apitest.b1.qiniudn.com/sample.wav</a> 可看出如下信息。</p>

<ul>
<li>存储空间名称是 <code>apitest</code></li>
<li>空间绑定域名是 <code>apitest.b1.qiniudn.com</code></li>
<li>空间隐私属性是 <code>公开</code></li>
<li>文件索引 (key) <code>sample.wav</code></li>
</ul>

<p>key 一般是具体的文件名称或路径（非“/”开头）。比如 <code>sample.wav</code> 和 <code>a/b/c.txt</code> 都是合法的 key 。</p>

<p><strong>文件隐私安全保护</strong></p>

<p>可以将空间属性设置为私有，设置为私有后，必须签发下载授权凭证才能提供文件访问。私有文件访问方式为：</p>

<pre><code>http://&lt;空间绑定域名&gt;/&lt;key&gt;?token=&lt;downloadToken&gt;
</code></pre>

<p><code>downloadToken</code> 支持有效期和作用域，</p>

<p>私有资源详情参考：<a href="/api/get.html#private-download">下载接口——私有资源下载</a></p>

<h2>结束语</h2>

<p>以上测试方案仅适用非编程环境，如果需要更深入的编程接入或其他测试，可以根据具体需求提供。请与我们保持联系！<a href="mailto:support@qiniu.com">support@qiniu.com</a></p>

				</article>
			</div>

			<div id="js-sidebar" class="sidebar-shell">
				<div class="js-toggle-list sidebar-module expandable">
					<ul>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">新手上路</span></h3>
						<ul class="js-guides">
							<li><a href="/guide/testing.html">测试指南</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">API</span></h3>
						<ul class="js-guides">
							<li><a href="/api/put.html">上传</a></li>
							<li><a href="/api/get.html">下载</a></li>
							<li><a href="/api/file-handle.html">文件管理</a></li>
							<li><a href="/api/image-process.html">图像处理</a></li>
							<li><a href="/api/audio-video-hls-process.html">音频/视频/流媒体处理</a></li>
							<li><a href="/api/qrcode.html">生成二维码 - QR code</a></li>
							<li><a href="/api/markdown-convert.html">Markdown 转 HTML</a></li>
							<li><a href="/api/pipeline.html">Pipeline API</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">SDK</span></h3>
						<ul class="js-guides">
							<li><a href="/ios-sdk/index.html">Objective-C (iOS)</a></li>
							<li><a href="/android-sdk/index.html">Java (Android)</a></li>
							<li><a href="/java-sdk/index.html">Java</a></li>
							<li><a href="/php-sdk/index.html">PHP</a></li>
							<li><a href="/python-sdk/index.html">Python</a></li>
							<li><a href="/ruby-sdk/index.html">Ruby</a></li>
							<li><a href="/nodejs-sdk/index.html">Node.js</a></li>
							<li><a href="/csharp-sdk/index.html">C#</a></li>
							<li><a href="/c-sdk/index.html">C/C++</a></li>
							<li><a href="/go-sdk/index.html">Go</a></li>
							<li><a href="/perl-sdk/index.html">Perl</a></li>							
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">上传及开发调试工具</span></h3>
						<ul class="js-guides">
							<li><a href="/tools/qrsync.html">qrsync</a></li>
							<li><a href="/tools/qboxrsctl.html">qboxrsctl</a></li>
							<li><a href="/tools/qiniu-autosync.html">qiniu-autosync</a></li>
						</ul>
						</li>
					</ul>
				</div> <!-- /sidebar-module -->
				<div class="sidebar-module">
					<p>帮助联系: <a href="mailto:support@qiniu.com">support@qiniu.com</a></p>
				</div>
			</div><!-- /sidebar-shell -->

		</div><!-- #wrapper -->

		<div id="footer" >
			<div class="lower_footer">
				<div class="footer_inner clearfix">
					<p>&copy; <span id="year">2012-2013</span> <a href="/">docs.qiniu.com</a>. All rights reserved. Powerd by <a href="http://www.qiniu.com" target="_blank">七牛云存储</a>. <a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备11037377号-2</a></p>
				</div><!-- /.site -->
			</div><!-- /.lower_footer -->
		</div><!-- /#footer -->

		<!-- <div class="popover fade top in"><div class="arrow"></div><h3 class="popover-title">测试指南</h3><div id="popover-content"></div></div> -->
		<script src="/static/js/jquery.js" type="text/javascript"></script>
		<script src="/static/js/qiniudoc.js" type="text/javascript"></script>
		<script src="/static/js/jquery.scrollUp.min.js"></script>
		<script type="text/javascript">
			   //var sdkName = "测试指南"
				 //$("#popover-content").html($("article ul")[0].outerHTML)
				 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
					m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
					})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

					ga('create', 'UA-40857860-3', 'qiniu.com');
					ga('send', 'pageview');
		 </script>
	 </body>
 </html>

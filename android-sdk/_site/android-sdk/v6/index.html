<!DOCTYPE html>
<html>
	<head>
		<meta name="robots" content="all" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="description" content="七牛云存储API和SDK文档" />
		<meta name="keywords" content="七牛, 七牛云存储, 七牛云存储API, 七牛云存储SDK, qrsync, qboxrsctl, QinuRS, S3" />
		<meta name="author" content="qiniu.com" />
		<meta name="copyright" content="qiniu.com" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Language" content="zh-cn" />
		<meta http-equiv="imagetoolbar" content="false" />
		<meta name="MSSmartTagsPreventParsing" content="true" />
		<title>Android SDK 使用指南 | 七牛云存储</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/gif" />
		<link href="/static/css/reset.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/960.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/uv_active4d.css" rel="stylesheet" type="text/css" />
		<link href="/static/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
	</head>
	<body class="api">
		<div id="header-wrapper">
			<div id="header">
				<div>
					<a class="logo" href="/">七牛云存储</a>
					<ul class="nav">
						<li><a href="https://portal.qiniu.com">开发者平台</a></li>
						<li><a href="http://www.qiniu.com">七牛官网</a></li>
						<!-- <li><a href="/faq/FAQ.html">FAQ</a></li> -->
					</ul>
				</div>
			</div><!-- #header -->
		</div><!-- #header-wrapper -->

		<div id="wrapper">
			<div class="content">	
				<h1>Android SDK 使用指南<span id="version">v6</span></h1>
				<article>
				<p>此 Android SDK 基于 <a href="http://docs.qiniu.com/">七牛云存储官方API</a> 构建。在开发者的 Android App 工程项目中使用此 SDK 能够非常方便地将 Android 系统里边的文件快速直传到七牛云存储。</p>

<p>出于安全考虑，使用此 SDK 无需设置密钥（AccessKey / SecretKey）。所有涉及到授权的操作，比如生成上传授权凭证（uploadToken）或下载授权凭证（downloadToken）均在业务服务器端进行。</p>

<p>业务服务器负责生成和颁发授权，此 SDK 只负责实施具体的上传业务。</p>

<h2>目录</h2>

<ul>
<li><a href="#upload-flow">上传流程</a></li>
<li><a href="#download-flow">下载流程</a></li>
<li><a href="#load">接入SDK</a></li>
<li><a href="#upload">使用SDK上传文件</a></li>
<li><a href="#demo">SDK 内置 demo 说明</a></li>
<li><a href="#contributing">贡献代码</a></li>
<li><a href="#license">许可证</a></li>
</ul>

<p><a name="upload-flow"></a></p>

<h2>上传流程</h2>

<ol>
<li><p>业务服务器使用七牛云存储服务端编程语言（如 PHP/Python/Ruby/Java）SDK 生成 uploadToken (上传授权凭证)</p></li>

<li><p>客户端 Android 使用该 uploadToken 调用此 Android 封装的上传方法直传文件到七牛云存储</p></li>

<li><p>文件直传成功，七牛云存储向 uploadToken 生成之前所指定的业务服务器地址发起回调</p></li>

<li><p>业务服务器接收来自七牛云存储回调的 POST 请求，处理相关 POST 参数，最后响应输出一段 JSON</p></li>

<li><p>七牛云存储接收业务服务器响应输出的这段 JSON，原封不动地通过 HTTP 返回给 Android 客户端程序</p></li>
</ol>

<p>注意事项：</p>

<ul>
<li>此 Android SDK 当前只提供上传方法，即负责上述流程中的第2个步骤。</li>
<li>业务服务器响应回调请求后输出 JSON，HTTP Headers 必须输出 <code>Content-Type</code> 为 <code>application/json</code>。</li>
<li>文件上传成功后，业务服务器输出的 JSON 数据，可从所调用SDK上传代码的返回值中获取到。</li>
</ul>

<p><a name="download-flow"></a></p>

<h2>下载流程</h2>

<p>此 Android SDK 没有提供下载文件的方法。所有上传到七牛云存储的文件，都能以如下方式进行访问：</p>

<p>公有资源：</p>

<pre><code>http://&lt;绑定域名&gt;/&lt;key&gt;
</code></pre>

<p>私有资源：</p>

<pre><code>http://&lt;绑定域名&gt;/&lt;key&gt;?token=&lt;downloadToken&gt;
</code></pre>

<p>出于安全考虑，此 SDK 不提供 <code>downloadToken</code> 的生成。除 Android / iOS SDK 以外，七牛云存储其他编程语言的 SDK 都有提供签发私有资源下载授权凭证（downloadToken）的实现。</p>

<p><a name="load"></a></p>

<h2>接入SDK</h2>

<p>本SDK的开发环境是 <a href="http://www.jetbrains.com/idea/">Intellij IDEA</a>，如果开发者使用的编辑器同为 IDEA, 直接打开项目即可，对于使用 <a href="http://www.eclipse.org/">Eclipse</a> 编辑器的开发者，可以尝试导入项目。</p>

<p>导入后，填写相关必要参数即可运行SDK自带的 demo 程序，配置方法见 <a href="#demo">SDK 内置 demo 说明</a> 。</p>

<p><a name="upload"></a></p>

<h2>使用SDK上传文件</h2>

<p>在 Android 中选择文件一般是通过 uri 作为路径, 一般调用以下代码</p>

<pre><code class="java">// 在七牛绑定的对应bucket的域名. 默认是bucket.qiniudn.com
public static String bucketName = &quot;bucketName&quot;;
public static String domain = bucketName + &quot;.qiniudn.com&quot;;
// upToken 这里需要自行获取. SDK 将不实现获取过程. 当token过期后才再获取一遍
public String UP_TOKEN = &quot;token&quot;;

boolean uploading = false;
/**
 * 普通上传文件
 * @param uri
 */
private void doUpload(Uri uri) {
    if (uploading) {
        hint.setText(&quot;上传中，请稍后&quot;);
        return;
    }
    uploading = true;
    String key = IO.UNDEFINED_KEY; // 自动生成key
    PutExtra extra = new PutExtra();
    extra.checkCrc = PutExtra.AUTO_CRC32;
    extra.params.put(&quot;x:arg&quot;, &quot;value&quot;);
    hint.setText(&quot;上传中&quot;);
    IO.putFile(this, UP_TOKEN, key, uri, extra, new JSONObjectRet() {
        @Override
        public void onSuccess(JSONObject resp) {
            uploading = false;
            String hash;
            String value;
            try {
                hash = resp.getString(&quot;hash&quot;);
                value = resp.getString(&quot;x:arg&quot;);
            } catch (Exception ex) {
                hint.setText(ex.getMessage());
                return;
            }
            String redirect = &quot;http://&quot; + domain + &quot;/&quot; + hash;
            hint.setText(&quot;上传成功! &quot; + hash);
            Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(redirect));
            startActivity(intent);
        }

        @Override
        public void onFailure(Exception ex) {
            uploading = false;
            hint.setText(&quot;错误: &quot; + ex.getMessage());
        }
    });
}
</code></pre>

<p><a name="demo"></a></p>

<h2>SDK 内置 demo 说明</h2>

<p>注意：demo 程序无法直接运行，需要配置 <code>UpToken</code>, <code>BucketName</code>, <code>Domain</code>信息, 将其填写到 MyActivity 之中。<code>key</code>值可以在操作界面修改。当文件上传成功时，会试图跳转到浏览器访问已经上传的资源。如果失败，会toast提示。</p>

<p><a name="contributing"></a></p>

<h2>贡献代码</h2>

<ol>
<li>Fork</li>
<li>创建您的特性分支 (<code>git checkout -b my-new-feature</code>)</li>
<li>提交您的改动 (<code>git commit -am 'Added some feature'</code>)</li>
<li>将您的修改记录提交到远程 <code>git</code> 仓库 (<code>git push origin my-new-feature</code>)</li>
<li>然后到 github 网站的该 <code>git</code> 远程仓库的 <code>my-new-feature</code> 分支下发起 Pull Request</li>
</ol>

<p><a name="license"></a></p>

<h2>许可证</h2>

<p>Copyright &copy; 2013 www.qiniu.com</p>

<p>基于 MIT 协议发布:</p>

<ul>
<li><a href="http://www.opensource.org/licenses/MIT">www.opensource.org/licenses/MIT</a></li>
</ul>

				</article>
			</div>

			<div id="js-sidebar" class="sidebar-shell">
				<div class="js-toggle-list sidebar-module expandable">
					<ul>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">新手上路</span></h3>
						<ul class="js-guides">
							<li><a href="/guide/testing.html">测试指南</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">API</span></h3>
						<ul class="js-guides">
							<li><a href="/api/put.html">上传</a></li>
							<li><a href="/api/get.html">下载</a></li>
							<li><a href="/api/file-handle.html">文件管理</a></li>
							<li><a href="/api/image-process.html">图像处理</a></li>
							<li><a href="/api/audio-video-hls-process.html">音频/视频/流媒体处理</a></li>
							<li><a href="/api/qrcode.html">生成二维码 - QR code</a></li>
							<li><a href="/api/markdown-convert.html">Markdown 转 HTML</a></li>
							<li><a href="/api/pipeline.html">Pipeline API</a></li>
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">SDK</span></h3>
						<ul class="js-guides">
							<li><a href="/ios-sdk/index.html">Objective-C (iOS)</a></li>
							<li><a href="/android-sdk/index.html">Java (Android)</a></li>
							<li><a href="/java-sdk/index.html">Java</a></li>
							<li><a href="/php-sdk/index.html">PHP</a></li>
							<li><a href="/python-sdk/index.html">Python</a></li>
							<li><a href="/ruby-sdk/index.html">Ruby</a></li>
							<li><a href="/nodejs-sdk/index.html">Node.js</a></li>
							<li><a href="/csharp-sdk/index.html">C#</a></li>
							<li><a href="/c-sdk/index.html">C/C++</a></li>
							<li><a href="/go-sdk/index.html">Go</a></li>
							<li><a href="/perl-sdk/index.html">Perl</a></li>							
						</ul>
						</li>
						<li class="js-topic">
						<h3><a href="#" class="js-expand-btn expanded">&nbsp;</a><span class="spapi">上传及开发调试工具</span></h3>
						<ul class="js-guides">
							<li><a href="/tools/qrsync.html">qrsync</a></li>
							<li><a href="/tools/qboxrsctl.html">qboxrsctl</a></li>
							<li><a href="/tools/qiniu-autosync.html">qiniu-autosync</a></li>
						</ul>
						</li>
					</ul>
				</div> <!-- /sidebar-module -->
				<div class="sidebar-module">
					<p>帮助联系: <a href="mailto:support@qiniu.com">support@qiniu.com</a></p>
				</div>
			</div><!-- /sidebar-shell -->

		</div><!-- #wrapper -->

		<div id="footer" >
			<div class="lower_footer">
				<div class="footer_inner clearfix">
					<p>&copy; <span id="year">2012-2013</span> <a href="/">docs.qiniu.com</a>. All rights reserved. Powerd by <a href="http://www.qiniu.com" target="_blank">七牛云存储</a>. <a href="http://www.miibeian.gov.cn/" target="_blank">沪ICP备11037377号-2</a></p>
				</div><!-- /.site -->
			</div><!-- /.lower_footer -->
		</div><!-- /#footer -->

		<!-- <div class="popover fade top in"><div class="arrow"></div><h3 class="popover-title">Android SDK 使用指南</h3><div id="popover-content"></div></div> -->
		<script src="/static/js/jquery.js" type="text/javascript"></script>
		<script src="/static/js/qiniudoc.js" type="text/javascript"></script>
		<script src="/static/js/jquery.scrollUp.min.js"></script>
		<script type="text/javascript">
			   //var sdkName = "Android SDK 使用指南"
				 //$("#popover-content").html($("article ul")[0].outerHTML)
				 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
					m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
					})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

					ga('create', 'UA-40857860-3', 'qiniu.com');
					ga('send', 'pageview');
		 </script>
	 </body>
 </html>
